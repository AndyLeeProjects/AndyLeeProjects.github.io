---
title: "Homework Assignment 2"
author: "Andy Lee"
date: "2022-03-08"
output: html_document
---

```{r}
# install.packages("geofacet")
library(tidyverse)
library(socviz)
library(lubridate)
library(geofacet)
library(ggthemes)
library(ggrepel)
library(ggridges)

```


## Question 1

![](https://bcdanl.github.io/DANL310_hw2_fig/hdi_corruption.png){width=100%}

```{r}
hdi_corruption <- read_csv(
  'https://bcdanl.github.io/data/hdi_corruption.csv')

# Use geom_smooth(method = lm, formula = "y ~ log(x)", se = F) .
# `box.padding` option would be useful for geom_text_repel().
glimpse(hdi_corruption)

hdi_corruption <- hdi_corruption %>%
  group_by(country) %>%
  mutate(
    max_hdi = max(hdi),
    country_text = ifelse(hdi == max_hdi, country, NA)
         ) 
  

p1 <- ggplot(data = subset(hdi_corruption, year == 2014), mapping = aes(x = cpi, y = hdi))+
    geom_smooth(method = lm, formula = "y ~ log(x)", se = F)+
    geom_point(aes(color = region), alpha = .5)+
    theme_minimal() + 
    scale_y_continuous(breaks = c(.4, .6, .8, 1)) +
    scale_x_continuous(breaks = c(20, 40, 60, 80)) +
    labs(x = "Corruption Perceptions Index, 2014 (100 = least corrupt)", 
         y = 'Human Developement 2014\n (1.0 = most developed)')+
    theme(legend.position = "top")+
    expand_limits(y = c(.3, 1.05))
    
p1 + geom_text_repel(data = subset(hdi_corruption, country_text %in% c('Argentina', 'China',
                                                                  'Egypt','Greece',
                                                                  'South Africa',
                                                                  'Senegal', 'Germany',
                                                                  'United States', 
                                                                  'Norway', 'Singapore')),
                           aes(label = country, group = region), max.overlaps = Inf,
                     box.padding = 1)
```


## Question 2
![](https://bcdanl.github.io/DANL310_hw2_fig/geo_facet_state_unemp.png){width=100%}


```{r}
unemp_house_prices <- read_csv(
  'https://bcdanl.github.io/data/unemp_house_prices.csv')

unemp_house_prices <- unemp_house_prices %>%
  select(date, state, unemploy_perc, house_price_index, house_price_perc) %>%
  filter(date > '2007-12-31')
  
  

xlabels = c("'09","'11","'13","'15","'17")
ggplot(data = unemp_house_prices, mapping = aes(x = as.character.Date(date)
                                                , y = unemploy_perc,group = 1))+
  geom_line() + 
  geom_area(fill = '#A6C5FF', alpha = .8) +
  scale_x_discrete(breaks=c('2009-01-01', '2011-01-01','2013-01-01','2015-01-01','2017-01-01'),labels=xlabels)+
  expand_limits(y = c(0, 15))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1, scale = 1))+
  geofacet::facet_geo(~state)+
  labs(y = "unemployment rate", x = NULL)


```


## Question 3
![](https://bcdanl.github.io/DANL310_hw2_fig/us_pres_election_county.png){width=100%}

```{r}
election_panel <- read_csv(
  'https://bcdanl.github.io/data/election_panel.csv')

us_states <- map_data("state")

# Use `county_map` data from the `socviz` package.
# Do not use coord_map().

# consider setting the margins for plot 
# change the color for the facet_wrap background

# Combine two data by region column
election_panel$region <- tolower(election_panel$state)
us_states_elec <- left_join(county_map, election_panel)

us_states_elec <- us_states_elec %>%
  filter(year <= 2020)

p <- ggplot(data = us_states_elec,
            mapping = aes(x = long, y = lat,
                          fill = pct_DEMOCRAT, 
                          group = group))
p1 <- p + geom_polygon(color = "gray90", size = 0.05) + coord_equal()+
  facet_wrap(~year, nrow = 2)

p2 <- p1 + scale_fill_gradient(low = "white", high = "#0066CC", guide = "colorbar",
                               breaks = c(3.1, 30.2, 40.6, 51.2, 95.7),
                               labels = c('3.1\n(min)','30.2\n(25th)','40.6\n(median)',
                                          '51.2\n(75th)','95.7\n(max)'),
                               limit = c(0,100), 
                               name = 'Percent Democrat')+
        labs(title = "U.S. Presidential Election, 2000 - 2020") 
# 
p3 <- p2 + theme_map() +
    theme(legend.position="bottom",
      strip.background=element_rect(colour="black",
                                    fill="#D6EBFD"),
      panel.background = element_rect(fill = "#E8E6E5",
                                colour = "#E8E6E5",
                                size = 0.5),
      plot.background = element_rect(fill = '#E8E6E5', colour = '#E8E6E5'),
      legend.key.size = unit(2.8, "cm"),
      legend.key.height = unit(.4, "cm"))
p3
```

