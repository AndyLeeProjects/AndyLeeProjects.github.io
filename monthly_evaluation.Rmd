---
title: "Monthly Evaluation "
author: "Andy"
output: html_document
---


<br>  

```{r setup, include=FALSE}
library(lubridate)
library(tm)
library(wordcloud)
library(ggwordcloud)
library(lubridate)
library(ggthemes)
library(psych)
library(gridExtra)
theme_set(theme_classic())
library(tidyverse)
```


```{r, include=FALSE}
cur_month = month(Sys.Date())
if (nchar(cur_month - 1) == 1 & cur_month != 1){
  previous_month = cur_month - 1  
  previous_month_str = paste0("0", previous_month, '/')
} else if (cur_month == 1){
  previous_month = 12
  previous_month_str = paste0(previous_month, '/')
} else {
  previous_month = cur_month - 1
  previous_month_str = paste0(previous_month, '/')
}
cur_year = year(Sys.Date())
cur_year_str = paste0('/',cur_year)
```

# **`r paste0(month.abb[previous_month], ' ', cur_year)`**

<br>  

![](`r paste0('/Volumes/Programming/Spring 2022/DANL 310/my_website/aLin-96.github.io/monthly_eval_images/', month.abb[previous_month], cur_year)`.jpg)

<br>  


```{r, include=FALSE}
all_dat = read.csv('/Volumes/Programming/Spring 2022/project/all_dat.csv')
morning_rt = read.csv('/Volumes/Programming/Spring 2022/Project/morning_routine.csv')

colnames(all_dat) <- c('X', 'Name','Finished','Multiple','Phone_pickups',
                       'Screen_time','Created','Date','Drink',
                       'Meditation','Mentality','Satisfaction',
                       'Reading','Productivity','Rise_time','Run','Social',
                       'Tech','Total','Total_todo','Work_done','Key_words')


# Remove unnecessary columns & Modify some columns
all_dat <- all_dat %>%
  dplyr::select(Date, everything(), Finished, Total_todo,-X,-Name,-Created, - Work_done) %>%
  dplyr::mutate(work_finished = round(Finished/Total_todo,4),
                Drink = lag(Drink),
                Total = Total*100) %>%
  dplyr::filter(Multiple < 6) %>%
  tibble()

all_dat_modified <- all_dat %>%
  filter(Social != 0) %>%
  mutate(Date = mdy(Date),
         Tech = as.factor(Tech),
         Productivity = as.factor(Productivity),
         Satisfaction = as.factor(Satisfaction),
         Social = as.factor(Social)) 
  
  

all_dat$Date[1:length(all_dat$Date)] = format(mdy(all_dat$Date[1:length(all_dat$Date)]),"%m/%d/%Y")

morning_rt <- morning_rt %>%
  dplyr::mutate(Date = strptime(as.character(morning_rt$Date), "%m/%d/%Y"),
         Date = format(Date, "%m/%d/%Y"),
         morning_phone = rise_time_check, # modify column name 
         night_phone = before_sleep_check) %>%
  dplyr::select(Date, everything(), -c(X, level_0, index, 
                                rise_time_check, before_sleep_check)) %>%
  tibble()

# merge morning_rt with all_dat
all_morning_rt <- merge(morning_rt, all_dat,by="Date", all.x=T) %>%
  dplyr::mutate(Date = mdy(Date),
         work_finished_mr_exc = 
           round((Finished-total_checked)/(Total_todo-6),4)) %>%
            # work_finished_mr_exc: this variable excludes morning routine 
            #         tasks for more accurate statistical analysis. 
  
  dplyr::select(-c(rise_time_min)) %>% # redundant
  dplyr::filter(work_finished_mr_exc <= 1 & work_finished_mr_exc >0) %>%
  arrange(desc(Date))

```


```{r, warning=FALSE, message=FALSE, include=FALSE}
cur_year = paste0('/',year(Sys.Date()))


words_dat <- all_dat %>%
  select(Key_words, Date) %>%
  filter(startsWith(Date, previous_month_str) == TRUE &
         endsWith(Date, cur_year) == TRUE) %>%
  filter(Key_words != 0 & Key_words != '' & Key_words != '[]') %>%
  mutate(Key_words = gsub('[\']','',Key_words),
         Key_words = gsub('[\\[]','',Key_words),
         Key_words = gsub('\\]','',Key_words)) %>%
  separate(Key_words, c('word_1', 'word_2', 'word_3'), sep = ',') %>%
  pivot_longer(cols = starts_with("word"), names_to = 'word_num', values_to = 'words') %>%
  mutate(words = gsub(" ", "", words)) %>%
  group_by(words) %>%
  summarise(freq = n())


```


## World Cloud  

---  


```{r, echo = TRUE, eval = TRUE, fig.width = 5, fig.height = 5,  warning = FALSE, fig.align="center"}

wordcloud(words = words_dat$words, freq = words_dat$freq, min.freq = .01,           
          max.words=70, random.order=FALSE, rot.per=0.35,            
          colors=brewer.pal(8, "Dark2"))

```

<br>  

## Monthly Evaluation  

---  


```{r, warning=FALSE, message=FALSE}
month_dat <- all_morning_rt %>%
  filter(startsWith(Date, previous_month_str) == TRUE &
         endsWith(Date, cur_year) == TRUE) %>%
  mutate(Date = mdy(Date),
         Tech = as.factor(Tech),
         Productivity = as.factor(Productivity),
         Satisfaction = as.factor(Satisfaction),
         Social = as.factor(Social)) 

rmarkdown::paged_table(month_dat)
```

<br>  

## Correlations  

---  

```{r, echo = TRUE, eval = TRUE, fig.width = 9, fig.height = 5, fig.asp = .75,  warning = FALSE}

correlation_plot <- month_dat %>%
  select(c(Screen_time, Drink, Meditation, 
           Reading, Rise_time, Run, Multiple, work_finished))

pairs.panels(correlation_plot, lm = TRUE)

```

<br>  


## Visualizations  

---  


```{r, warning=FALSE, message=FALSE}
ggplot(data = month_dat, aes(x = Date, y = Total)) +
  geom_line(aes(color = 'red')) +
  geom_smooth(color = 'red', se=) + 
  theme(legend.position = "None") +
  ylim(0,100) +
  labs(title = paste0(month.abb[previous_month], ": Daily Total Trend"),
       subtitle = paste0("Total AVG: ", as.character(round(mean(month_dat$Total), 2))))
```
<br>  

## Productivity

```{r, echo = TRUE, eval = TRUE, fig.width = 10, fig.height = 5,  warning = FALSE}
g1 <- ggplot(data = all_dat_modified) +
  geom_bar(aes(x = Productivity, fill = Tech)) +
  guides(fill=guide_legend(title="Tech Consumption\n1: Worst, 5: Best")) +
  labs(title = "ALL Data: Productivity & Tech Consumption\n")


g2 <- ggplot(data = month_dat) +
  geom_bar(aes(x = Productivity, fill = Tech)) +
  guides(fill=guide_legend(title="Tech Consumption\n1: Worst, 5: Best")) +
  labs(title = paste0(month.abb[previous_month], " Data: Productivity & Tech Consumption\n"))

grid.arrange(g1, g2, ncol = 2)
```

<br>  

```{r, echo = TRUE, eval = TRUE, fig.width = 10, fig.height = 5,  warning = FALSE, message = FALSE}
g1 <- ggplot(data = all_dat_modified) + 
    geom_smooth(aes(x = Screen_time, y = work_finished, color = Productivity),
              se = F) +
  labs(title = "ALL Data: Productivity & Tech Consumption")
g2 <- ggplot(data = month_dat) + 
    geom_smooth(aes(x = Screen_time, y = work_finished, color = Productivity),
              se = F) +
  labs(title = paste0(month.abb[previous_month], " Data: Productivity & Tech Consumption"))

grid.arrange(g1, g2, ncol = 2)
```

